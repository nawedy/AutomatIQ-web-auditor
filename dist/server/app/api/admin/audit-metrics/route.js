(()=>{var e={};e.id=5495,e.ids=[5495],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},5486:e=>{"use strict";e.exports=require("bcrypt")},7462:(e,t,r)=>{"use strict";r.d(t,{Gr:()=>o,zR:()=>i});var s=r(96330),a=r(88909);let i=globalThis.prisma??new s.PrismaClient({log:["error"],datasources:{db:{url:process.env.DATABASE_URL}}});async function o(e){try{await i.$executeRaw`SELECT set_config('app.current_user_id', ${e}, false)`}catch(e){throw console.error("Failed to set current user ID:",e),e}}process.env.DATABASE_URL&&new a.bC({connectionString:process.env.DATABASE_URL})},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11723:e=>{"use strict";e.exports=require("querystring")},12412:e=>{"use strict";e.exports=require("assert")},14133:(e,t,r)=>{"use strict";r.d(t,{P:()=>i});var s=r(90672),a=r(278);function i(e,t){let r=(0,s.a)(e);if(isNaN(t))return(0,a.w)(e,NaN);if(!t)return r;let i=r.getDate(),o=(0,a.w)(e,r.getTime());return(o.setMonth(r.getMonth()+t+1,0),i>=o.getDate())?o:(r.setFullYear(o.getFullYear(),o.getMonth(),i),r)}},27650:(e,t,r)=>{"use strict";r.d(t,{e:()=>a});var s=r(59217);function a(e,t){return(0,s.f)(e,-t)}},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},43254:(e,t,r)=>{"use strict";r.d(t,{ru:()=>n});var s=r(7462),a=r(19854),i=r(86753),o=r(32190);function n(e){return async(t,r)=>{try{let n=await (0,a.getServerSession)(i.N);if(!n?.user?.email)return o.NextResponse.json({error:"Unauthorized"},{status:401});let c=await s.zR.user.findUnique({where:{email:n.user.email},select:{id:!0,email:!0}});if(!c)return o.NextResponse.json({error:"User not found"},{status:404});return await (0,s.Gr)(c.id),e(t,r,c)}catch(e){return console.error("Authentication error:",e),o.NextResponse.json({error:"Authentication failed"},{status:500})}}}},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},59217:(e,t,r)=>{"use strict";r.d(t,{f:()=>i});var s=r(90672),a=r(278);function i(e,t){let r=(0,s.a)(e);return isNaN(t)?(0,a.w)(e,NaN):(t&&r.setDate(r.getDate()+t),r)}},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},76152:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>A,routeModule:()=>w,serverHooks:()=>h,workAsyncStorage:()=>y,workUnitAsyncStorage:()=>m});var s={};r.r(s),r.d(s,{GET:()=>g});var a=r(96559),i=r(48088),o=r(37719),n=r(32190),c=r(43254),u=r(79464),d=r(27650),l=r(14133),p=r(28744);let g=(0,c.ru)(async(e,t,r)=>{if("admin"!==r.role)return n.NextResponse.json({error:"Unauthorized: Admin access required"},{status:403});try{let t=new URL(e.url).searchParams.get("timeRange")||"week",r=new Date,s=new Date,a=7;switch(t){case"week":default:s=(0,d.e)(r,7),a=7;break;case"month":s=(0,l.P)(r,-1),a=30;break;case"quarter":s=function(e,t){return(0,l.P)(e,-3)}(r,0),a=90}let i=await u.Ay.audit.count({where:{createdAt:{gte:s}}}),o=await u.Ay.audit.count({where:{createdAt:{gte:s},status:"completed"}}),c=await u.Ay.audit.count({where:{createdAt:{gte:s},status:"failed"}}),g=await u.Ay.audit.findMany({where:{createdAt:{gte:s},status:"completed",startedAt:{not:null},completedAt:{not:null}},select:{startedAt:!0,completedAt:!0}}),w=0;g.forEach(e=>{if(e.startedAt&&e.completedAt){let t=e.completedAt.getTime()-e.startedAt.getTime();w+=t}});let y=g.length>0?w/g.length:0,m=(await u.Ay.auditResult.groupBy({by:["severity"],where:{createdAt:{gte:s}},_count:{id:!0}})).reduce((e,t)=>(e[t.severity]=t._count.id,e),{error:0,warning:0,info:0,success:0}),h=await u.Ay.auditResult.groupBy({by:["categoryId"],where:{createdAt:{gte:s}},_count:{id:!0}}),A=(await u.Ay.auditCategory.findMany({select:{id:!0,name:!0}})).reduce((e,t)=>(e[t.id]=t.name,e),{}),f=h.map(e=>({category:A[e.categoryId]||"Unknown",count:e._count.id})),v=[],x=[],S=e=>"week"===t?(0,p.GP)(e,"EEE"):"month"===t?(0,p.GP)(e,"MMM d"):(0,p.GP)(e,"MMM"),R="week"===t?1:"month"===t?3:10,b="week"===t?7:"month"===t?10:9;for(let e=0;e<b;e++){let t=(0,d.e)(r,e*R),s=(0,d.e)(t,R-1);s.setHours(0,0,0,0),t.setHours(23,59,59,999);let a=await u.Ay.audit.count({where:{createdAt:{gte:s,lte:t}}}),i=await u.Ay.auditResult.count({where:{createdAt:{gte:s,lte:t},severity:"error"}}),o=await u.Ay.auditResult.count({where:{createdAt:{gte:s,lte:t},severity:"warning"}}),n=await u.Ay.auditResult.count({where:{createdAt:{gte:s,lte:t},severity:"info"}}),c=S(s);v.push({date:c,count:a}),x.push({date:c,critical:i,warning:o,info:n})}let E=await u.Ay.auditSummary.findMany({where:{createdAt:{gte:s}},select:{seoScore:!0,performanceScore:!0,accessibilityScore:!0,securityScore:!0,bestPracticesScore:!0}}),q=0,P=0,N=0,_=0,D=0;E.forEach(e=>{q+=e.seoScore||0,P+=e.performanceScore||0,N+=e.accessibilityScore||0,_+=e.securityScore||0,D+=e.bestPracticesScore||0});let T=E.length,k=new Date(s);k.setDate(k.getDate()-a);let C=await u.Ay.auditSummary.findMany({where:{createdAt:{gte:k,lt:s}},select:{seoScore:!0,performanceScore:!0,accessibilityScore:!0,securityScore:!0,bestPracticesScore:!0}}),I=0;C.forEach(e=>{I+=((e.seoScore||0)+(e.performanceScore||0)+(e.accessibilityScore||0)+(e.securityScore||0)+(e.bestPracticesScore||0))/5});let M=C.length>0?I/C.length:0,U=T>0?(q+P+N+_+D)/(5*T):0,j=[{category:"SEO",average:T>0?q/T:0,highest:100,lowest:0},{category:"Performance",average:T>0?P/T:0,highest:100,lowest:0},{category:"Accessibility",average:T>0?N/T:0,highest:100,lowest:0},{category:"Security",average:T>0?_/T:0,highest:100,lowest:0},{category:"Best Practices",average:T>0?D/T:0,highest:100,lowest:0}],B=await u.Ay.auditResult.count({where:{createdAt:{gte:s},status:"fixed"}}),G=await u.Ay.auditResult.count({where:{createdAt:{gte:k,lt:s},status:"fixed"}}),L=await u.Ay.auditResult.count({where:{createdAt:{gte:s},severity:{in:["error","warning"]}}}),O={totalAudits:i,completedAudits:o,failedAudits:c,averageAuditDuration:y,categoryScores:j,issuesByDay:x.reverse(),issuesBySeverity:{critical:m.error||0,warning:m.warning||0,info:m.info||0},issuesByCategory:f,auditsByDay:v.reverse(),averageScores:{overall:U,previousPeriod:M,change:M>0?U-M:0},issuesFixed:{count:B,rate:L>0?B/L*100:0,change:G>0?(B-G)/G*100:0}};return n.NextResponse.json(O)}catch(e){return console.error("Error fetching audit metrics:",e),n.NextResponse.json({error:"Failed to fetch audit metrics"},{status:500})}}),w=new a.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/admin/audit-metrics/route",pathname:"/api/admin/audit-metrics",filename:"route",bundlePath:"app/api/admin/audit-metrics/route"},resolvedPagePath:"/Users/drgn003/AutomatIQ/AI-website-auditor/app/api/admin/audit-metrics/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:y,workUnitAsyncStorage:m,serverHooks:h}=w;function A(){return(0,o.patchFetch)({workAsyncStorage:y,workUnitAsyncStorage:m})}},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79464:(e,t,r)=>{"use strict";r.d(t,{Ay:()=>i,zR:()=>a});var s=r(96330);let a=global.prisma||new s.PrismaClient({log:["error"]}),i=a},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},86753:(e,t,r)=>{"use strict";r.d(t,{N:()=>d});var s=r(16467),a=r(13581),i=r(36344),o=r(65752),n=r(96330),c=r(5486);r(19854);let u=new n.PrismaClient,d={adapter:(0,s.y)(u),session:{strategy:"jwt"},pages:{signIn:"/auth/login",signOut:"/auth/logout",error:"/auth/error"},providers:[(0,a.A)({name:"Credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let t=await u.user.findUnique({where:{email:e.email}});return t&&t.password&&await (0,c.compare)(e.password,t.password)?{id:t.id,email:t.email,name:t.name,image:t.image}:null}}),(0,i.A)({clientId:process.env.GOOGLE_CLIENT_ID||"",clientSecret:process.env.GOOGLE_CLIENT_SECRET||""}),(0,o.A)({clientId:process.env.GITHUB_CLIENT_ID||"",clientSecret:process.env.GITHUB_CLIENT_SECRET||""})],callbacks:{session:async({session:e,token:t})=>(t&&(e.user.id=t.id,e.user.name=t.name,e.user.email=t.email,e.user.image=t.picture),e),jwt:async({token:e,user:t})=>(t&&(e.id=t.id),e)}}},94735:e=>{"use strict";e.exports=require("events")},96330:e=>{"use strict";e.exports=require("@prisma/client")},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[4243,580,9854,8909,2256,8744],()=>r(76152));module.exports=s})();