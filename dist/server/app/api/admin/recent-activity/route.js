(()=>{var e={};e.id=7003,e.ids=[7003],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},5486:e=>{"use strict";e.exports=require("bcrypt")},7462:(e,t,r)=>{"use strict";r.d(t,{Gr:()=>n,zR:()=>i});var s=r(96330),a=r(88909);let i=globalThis.prisma??new s.PrismaClient({log:["error"],datasources:{db:{url:process.env.DATABASE_URL}}});async function n(e){try{await i.$executeRaw`SELECT set_config('app.current_user_id', ${e}, false)`}catch(e){throw console.error("Failed to set current user ID:",e),e}}process.env.DATABASE_URL&&new a.bC({connectionString:process.env.DATABASE_URL})},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11723:e=>{"use strict";e.exports=require("querystring")},12412:e=>{"use strict";e.exports=require("assert")},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},43254:(e,t,r)=>{"use strict";r.d(t,{ru:()=>u});var s=r(7462),a=r(19854),i=r(86753),n=r(32190);function u(e){return async(t,r)=>{try{let u=await (0,a.getServerSession)(i.N);if(!u?.user?.email)return n.NextResponse.json({error:"Unauthorized"},{status:401});let o=await s.zR.user.findUnique({where:{email:u.user.email},select:{id:!0,email:!0}});if(!o)return n.NextResponse.json({error:"User not found"},{status:404});return await (0,s.Gr)(o.id),e(t,r,o)}catch(e){return console.error("Authentication error:",e),n.NextResponse.json({error:"Authentication failed"},{status:500})}}}},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79464:(e,t,r)=>{"use strict";r.d(t,{Ay:()=>i,zR:()=>a});var s=r(96330);let a=global.prisma||new s.PrismaClient({log:["error"]}),i=a},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},86753:(e,t,r)=>{"use strict";r.d(t,{N:()=>c});var s=r(16467),a=r(13581),i=r(36344),n=r(65752),u=r(96330),o=r(5486);r(19854);let l=new u.PrismaClient,c={adapter:(0,s.y)(l),session:{strategy:"jwt"},pages:{signIn:"/auth/login",signOut:"/auth/logout",error:"/auth/error"},providers:[(0,a.A)({name:"Credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let t=await l.user.findUnique({where:{email:e.email}});return t&&t.password&&await (0,o.compare)(e.password,t.password)?{id:t.id,email:t.email,name:t.name,image:t.image}:null}}),(0,i.A)({clientId:process.env.GOOGLE_CLIENT_ID||"",clientSecret:process.env.GOOGLE_CLIENT_SECRET||""}),(0,n.A)({clientId:process.env.GITHUB_CLIENT_ID||"",clientSecret:process.env.GITHUB_CLIENT_SECRET||""})],callbacks:{session:async({session:e,token:t})=>(t&&(e.user.id=t.id,e.user.name=t.name,e.user.email=t.email,e.user.image=t.picture),e),jwt:async({token:e,user:t})=>(t&&(e.id=t.id),e)}}},89942:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>b,routeModule:()=>y,serverHooks:()=>D,workAsyncStorage:()=>x,workUnitAsyncStorage:()=>v});var s={};r.r(s),r.d(s,{GET:()=>A});var a=r(96559),i=r(48088),n=r(37719),u=r(32190),o=r(43254),l=r(79464),c=r(278),d=r(90672);function m(e,t){let r=(0,d.a)(e),s=(0,d.a)(t),a=r.getTime()-s.getTime();return a<0?-1:a>0?1:a}var p=r(65342),f=r(23729),g=r(66429),w=r(44413);function h(e,t){return function(e,t,r){let s,a,i,n=(0,g.q)(),u=r?.locale??n.locale??f.c,o=m(e,t);if(isNaN(o))throw RangeError("Invalid time value");let l=Object.assign({},r,{addSuffix:r?.addSuffix,comparison:o});o>0?(s=(0,d.a)(t),a=(0,d.a)(e)):(s=(0,d.a)(e),a=(0,d.a)(t));let c=function(e,t,r){var s;return(s=void 0,e=>{let t=(s?Math[s]:Math.trunc)(e);return 0===t?0:t})(((0,d.a)(e)-(0,d.a)(t))/1e3)}(a,s),h=Math.round((c-((0,w.G)(a)-(0,w.G)(s))/1e3)/60);if(h<2)if(r?.includeSeconds)if(c<5)return u.formatDistance("lessThanXSeconds",5,l);else if(c<10)return u.formatDistance("lessThanXSeconds",10,l);else if(c<20)return u.formatDistance("lessThanXSeconds",20,l);else if(c<40)return u.formatDistance("halfAMinute",0,l);else if(c<60)return u.formatDistance("lessThanXMinutes",1,l);else return u.formatDistance("xMinutes",1,l);else if(0===h)return u.formatDistance("lessThanXMinutes",1,l);else return u.formatDistance("xMinutes",h,l);if(h<45)return u.formatDistance("xMinutes",h,l);if(h<90)return u.formatDistance("aboutXHours",1,l);if(h<p.F6){let e=Math.round(h/60);return u.formatDistance("aboutXHours",e,l)}if(h<2520)return u.formatDistance("xDays",1,l);else if(h<p.Nw){let e=Math.round(h/p.F6);return u.formatDistance("xDays",e,l)}else if(h<2*p.Nw)return i=Math.round(h/p.Nw),u.formatDistance("aboutXMonths",i,l);if((i=function(e,t){let r,s=(0,d.a)(e),a=(0,d.a)(t),i=m(s,a),n=Math.abs(function(e,t){let r=(0,d.a)(e),s=(0,d.a)(t);return 12*(r.getFullYear()-s.getFullYear())+(r.getMonth()-s.getMonth())}(s,a));if(n<1)r=0;else{1===s.getMonth()&&s.getDate()>27&&s.setDate(30),s.setMonth(s.getMonth()-i*n);let t=m(s,a)===-i;(function(e){let t=(0,d.a)(e);return+function(e){let t=(0,d.a)(e);return t.setHours(23,59,59,999),t}(t)==+function(e){let t=(0,d.a)(e),r=t.getMonth();return t.setFullYear(t.getFullYear(),r+1,0),t.setHours(23,59,59,999),t}(t)})((0,d.a)(e))&&1===n&&1===m(e,a)&&(t=!1),r=i*(n-Number(t))}return 0===r?0:r}(a,s))<12){let e=Math.round(h/p.Nw);return u.formatDistance("xMonths",e,l)}{let e=i%12,t=Math.trunc(i/12);return e<3?u.formatDistance("aboutXYears",t,l):e<9?u.formatDistance("overXYears",t,l):u.formatDistance("almostXYears",t+1,l)}}(e,(0,c.w)(e,Date.now()),t)}let A=(0,o.ru)(async(e,t,r)=>{if("admin"!==r.role)return u.NextResponse.json({error:"Unauthorized: Admin access required"},{status:403});try{let t=new URL(e.url),r=parseInt(t.searchParams.get("limit")||"10",10),s=await l.Ay.audit.findMany({take:r,orderBy:{createdAt:"desc"},include:{website:{select:{url:!0,name:!0,client:{select:{name:!0,id:!0}}}},user:{select:{name:!0,email:!0,id:!0}}}}),a=await l.Ay.session.findMany({take:r,orderBy:{createdAt:"desc"},include:{user:{select:{name:!0,email:!0,id:!0,role:!0}}}}),i=await l.Ay.client.findMany({take:r,orderBy:{createdAt:"desc"},select:{id:!0,name:!0,createdAt:!0,status:!0,websites:{select:{id:!0}},users:{select:{id:!0}}}}),n=await l.Ay.systemAlert.findMany({take:r,orderBy:{createdAt:"desc"},select:{id:!0,type:!0,message:!0,severity:!0,createdAt:!0,resolved:!0}}),o=s.map(e=>({id:e.id,type:"audit",title:`Audit for ${e.website.name||e.website.url}`,clientName:e.website.client.name,clientId:e.website.client.id,status:e.status,user:e.user?{id:e.user.id,name:e.user.name||e.user.email}:null,timestamp:e.createdAt,timeAgo:h(new Date(e.createdAt),{addSuffix:!0}),details:{websiteUrl:e.website.url,duration:e.completedAt&&e.startedAt?(new Date(e.completedAt).getTime()-new Date(e.startedAt).getTime())/1e3:null}})),c=a.map(e=>({id:e.id,type:"login",title:`User login: ${e.user.name||e.user.email}`,user:{id:e.user.id,name:e.user.name||e.user.email,role:e.user.role},timestamp:e.createdAt,timeAgo:h(new Date(e.createdAt),{addSuffix:!0}),details:{userAgent:e.userAgent||"Unknown device",ipAddress:e.ipAddress||"Unknown location"}})),d=i.map(e=>({id:e.id,type:"client",title:`New client: ${e.name}`,status:e.status,timestamp:e.createdAt,timeAgo:h(new Date(e.createdAt),{addSuffix:!0}),details:{websiteCount:e.websites.length,userCount:e.users.length}})),m=n.map(e=>({id:e.id,type:"alert",title:e.message,severity:e.severity,timestamp:e.createdAt,timeAgo:h(new Date(e.createdAt),{addSuffix:!0}),resolved:e.resolved,details:{alertType:e.type}})),p=[...o,...c,...d,...m].sort((e,t)=>new Date(t.timestamp).getTime()-new Date(e.timestamp).getTime()).slice(0,r);return u.NextResponse.json({recentActivity:p,counts:{audits:o.length,logins:c.length,clients:d.length,alerts:m.length}})}catch(e){return console.error("Error fetching recent activity:",e),u.NextResponse.json({error:"Failed to fetch recent activity"},{status:500})}}),y=new a.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/admin/recent-activity/route",pathname:"/api/admin/recent-activity",filename:"route",bundlePath:"app/api/admin/recent-activity/route"},resolvedPagePath:"/Users/drgn003/AutomatIQ/AI-website-auditor/app/api/admin/recent-activity/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:x,workUnitAsyncStorage:v,serverHooks:D}=y;function b(){return(0,n.patchFetch)({workAsyncStorage:x,workUnitAsyncStorage:v})}},94735:e=>{"use strict";e.exports=require("events")},96330:e=>{"use strict";e.exports=require("@prisma/client")},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[4243,580,9854,8909,2256],()=>r(89942));module.exports=s})();