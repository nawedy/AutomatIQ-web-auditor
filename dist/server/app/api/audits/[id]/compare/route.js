(()=>{var e={};e.id=4780,e.ids=[4780],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},5486:e=>{"use strict";e.exports=require("bcrypt")},7462:(e,t,r)=>{"use strict";r.d(t,{Gr:()=>o,zR:()=>i});var s=r(96330),a=r(88909);let i=globalThis.prisma??new s.PrismaClient({log:["error"],datasources:{db:{url:process.env.DATABASE_URL}}});async function o(e){try{await i.$executeRaw`SELECT set_config('app.current_user_id', ${e}, false)`}catch(e){throw console.error("Failed to set current user ID:",e),e}}process.env.DATABASE_URL&&new a.bC({connectionString:process.env.DATABASE_URL})},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11723:e=>{"use strict";e.exports=require("querystring")},12412:e=>{"use strict";e.exports=require("assert")},13581:(e,t)=>{"use strict";t.A=function(e){return{id:"credentials",name:"Credentials",type:"credentials",credentials:{},authorize:()=>null,options:e}}},16467:(e,t,r)=>{"use strict";r.d(t,{y:()=>a});var s=r(96330);function a(e){return{createUser:({id:t,...r})=>e.user.create(i(r)),getUser:t=>e.user.findUnique({where:{id:t}}),getUserByEmail:t=>e.user.findUnique({where:{email:t}}),async getUserByAccount(t){let r=await e.account.findUnique({where:{provider_providerAccountId:t},include:{user:!0}});return r?.user??null},updateUser:({id:t,...r})=>e.user.update({where:{id:t},...i(r)}),deleteUser:t=>e.user.delete({where:{id:t}}),linkAccount:t=>e.account.create({data:t}),unlinkAccount:t=>e.account.delete({where:{provider_providerAccountId:t}}),async getSessionAndUser(t){let r=await e.session.findUnique({where:{sessionToken:t},include:{user:!0}});if(!r)return null;let{user:s,...a}=r;return{user:s,session:a}},createSession:t=>e.session.create(i(t)),updateSession:t=>e.session.update({where:{sessionToken:t.sessionToken},...i(t)}),deleteSession:t=>e.session.delete({where:{sessionToken:t}}),async createVerificationToken(t){let r=await e.verificationToken.create(i(t));return"id"in r&&r.id&&delete r.id,r},async useVerificationToken(t){try{let r=await e.verificationToken.delete({where:{identifier_token:t}});return"id"in r&&r.id&&delete r.id,r}catch(e){if(e instanceof s.Prisma.PrismaClientKnownRequestError&&"P2025"===e.code)return null;throw e}},getAccount:async(t,r)=>e.account.findFirst({where:{providerAccountId:t,provider:r}}),createAuthenticator:async t=>e.authenticator.create(i(t)),getAuthenticator:async t=>e.authenticator.findUnique({where:{credentialID:t}}),listAuthenticatorsByUserId:async t=>e.authenticator.findMany({where:{userId:t}}),updateAuthenticatorCounter:async(t,r)=>e.authenticator.update({where:{credentialID:t},data:{counter:r}})}}function i(e){let t={};for(let r in e)void 0!==e[r]&&(t[r]=e[r]);return{data:t}}},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33131:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>g,routeModule:()=>p,serverHooks:()=>f,workAsyncStorage:()=>h,workUnitAsyncStorage:()=>m});var s={};r.r(s),r.d(s,{GET:()=>d});var a=r(96559),i=r(48088),o=r(37719),n=r(32190),c=r(43254),u=r(7462);class l{constructor(e){this.prisma=e}async compareAudits(e,t){try{let[r,s]=await Promise.all([this.prisma.audit.findUnique({where:{id:e},include:{auditResults:{include:{category:!0,check:!0}}}}),this.prisma.audit.findUnique({where:{id:t},include:{auditResults:{include:{category:!0,check:!0}}}})]);if(!r||!s)throw Error("One or both audits not found");let a=this.calculateTimeGap(new Date(r.createdAt),new Date(s.createdAt)),i=this.compareScores(r.overallScore||0,s.overallScore||0),o=[{category:"SEO",scores:this.compareScores(r.seoScore||0,s.seoScore||0)},{category:"Performance",scores:this.compareScores(r.performanceScore||0,s.performanceScore||0)},{category:"Accessibility",scores:this.compareScores(r.accessibilityScore||0,s.accessibilityScore||0)},{category:"Security",scores:this.compareScores(r.securityScore||0,s.securityScore||0)},{category:"Mobile",scores:this.compareScores(r.mobileScore||0,s.mobileScore||0)},{category:"Content",scores:this.compareScores(r.contentScore||0,s.contentScore||0)}],n=[],c=[];o.forEach(e=>{e.scores.change>5?n.push(e.category):e.scores.change<-5&&c.push(e.category)});let u=new Map(r.auditResults.map(e=>[`${e.categoryId}-${e.checkId}`,e])),l=new Map(s.auditResults.map(e=>[`${e.categoryId}-${e.checkId}`,e]));return u.forEach((e,t)=>{let r=l.get(t);if(r){let t=e.score-r.score;t>=20?n.push(`${e.check.name} (${e.category.name}): +${t.toFixed(1)} points`):t<=-20&&c.push(`${e.check.name} (${e.category.name}): ${t.toFixed(1)} points`)}}),{currentAudit:r,previousAudit:s,overallScoreComparison:i,categoryComparisons:o,improvementAreas:n,declineAreas:c,timeGap:a}}catch(e){throw console.error("Error comparing audits:",e),Error(`Failed to compare audits: ${e.message}`)}}async compareLatestAudits(e){try{let t=await this.prisma.audit.findMany({where:{websiteId:e,status:"COMPLETED"},orderBy:{createdAt:"desc"},take:2});if(t.length<2)return null;return this.compareAudits(t[0].id,t[1].id)}catch(e){throw console.error("Error comparing latest audits:",e),Error(`Failed to compare latest audits: ${e.message}`)}}async analyzeTrends(e,t="last30days"){try{let r,s=new Date;switch(t){case"last30days":default:(r=new Date(s)).setDate(s.getDate()-30);break;case"last3months":(r=new Date(s)).setMonth(s.getMonth()-3);break;case"lastYear":(r=new Date(s)).setFullYear(s.getFullYear()-1)}let a=await this.prisma.audit.findMany({where:{websiteId:e,status:"COMPLETED",createdAt:{gte:r}},orderBy:{createdAt:"asc"}});if(0===a.length)throw Error("No audits found for the specified period");let i=a.map(e=>({date:e.createdAt.toISOString().split("T")[0],score:e.overallScore||0})),o={SEO:a.map(e=>({date:e.createdAt.toISOString().split("T")[0],score:e.seoScore||0})),Performance:a.map(e=>({date:e.createdAt.toISOString().split("T")[0],score:e.performanceScore||0})),Accessibility:a.map(e=>({date:e.createdAt.toISOString().split("T")[0],score:e.accessibilityScore||0})),Security:a.map(e=>({date:e.createdAt.toISOString().split("T")[0],score:e.securityScore||0})),Mobile:a.map(e=>({date:e.createdAt.toISOString().split("T")[0],score:e.mobileScore||0})),Content:a.map(e=>({date:e.createdAt.toISOString().split("T")[0],score:e.contentScore||0}))},n={};Object.entries(o).forEach(([e,t])=>{if(t.length>=2){let r=t[0].score,s=t[t.length-1].score;n[e]=s-r}else n[e]=0});let c=Object.keys(n)[0],u=Object.keys(n)[0];return Object.entries(n).forEach(([e,t])=>{t>n[c]&&(c=e),t<n[u]&&(u=e)}),{websiteId:e,period:t,overallScoreTrend:i,categoryScoreTrends:o,mostImprovedCategory:c,leastImprovedCategory:u}}catch(e){throw console.error("Error analyzing trends:",e),Error(`Failed to analyze trends: ${e.message}`)}}compareScores(e,t){let r=e-t;return{current:e,previous:t,change:r,percentChange:0===t?0:r/t*100}}calculateTimeGap(e,t){let r=Math.floor((e.getTime()-t.getTime())/864e5);if(r<1)return"Less than a day";if(1===r)return"1 day";if(r<7)return`${r} days`;if(r<14)return"1 week";if(r<30)return`${Math.floor(r/7)} weeks`;else if(r<60)return"1 month";else if(r<365)return`${Math.floor(r/30)} months`;else if(r<730)return"1 year";else return`${Math.floor(r/365)} years`}}let d=(0,c.ru)(async(e,{params:t},r)=>{try{let s=t.id,a=e.nextUrl.searchParams.get("compareWithId"),i=await u.zR.audit.findFirst({where:{id:s,userId:r.id},include:{website:!0}});if(!i)return n.NextResponse.json({error:"Audit not found or you do not have permission to access it"},{status:404});let o=new l(u.zR);if(a){if(!await u.zR.audit.findFirst({where:{id:a,userId:r.id}}))return n.NextResponse.json({error:"Comparison audit not found or you do not have permission to access it"},{status:404});let e=await o.compareAudits(s,a);return n.NextResponse.json(e)}{let e=i.websiteId,t=await u.zR.audit.findFirst({where:{websiteId:e,userId:r.id,id:{not:s},status:"COMPLETED"},orderBy:{createdAt:"desc"}});if(!t)return n.NextResponse.json({error:"No previous audit found for comparison"},{status:404});let a=await o.compareAudits(s,t.id);return n.NextResponse.json(a)}}catch(e){return console.error("Error comparing audits:",e),n.NextResponse.json({error:`Failed to compare audits: ${e.message}`},{status:500})}}),p=new a.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/audits/[id]/compare/route",pathname:"/api/audits/[id]/compare",filename:"route",bundlePath:"app/api/audits/[id]/compare/route"},resolvedPagePath:"/Users/drgn003/AutomatIQ/AI-website-auditor/app/api/audits/[id]/compare/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:h,workUnitAsyncStorage:m,serverHooks:f}=p;function g(){return(0,o.patchFetch)({workAsyncStorage:h,workUnitAsyncStorage:m})}},36344:(e,t)=>{"use strict";t.A=function(e){return{id:"google",name:"Google",type:"oauth",wellKnown:"https://accounts.google.com/.well-known/openid-configuration",authorization:{params:{scope:"openid email profile"}},idToken:!0,checks:["pkce","state"],profile:e=>({id:e.sub,name:e.name,email:e.email,image:e.picture}),style:{logo:"/google.svg",bg:"#fff",text:"#000"},options:e}}},43254:(e,t,r)=>{"use strict";r.d(t,{ru:()=>n});var s=r(7462),a=r(19854),i=r(86753),o=r(32190);function n(e){return async(t,r)=>{try{let n=await (0,a.getServerSession)(i.N);if(!n?.user?.email)return o.NextResponse.json({error:"Unauthorized"},{status:401});let c=await s.zR.user.findUnique({where:{email:n.user.email},select:{id:!0,email:!0}});if(!c)return o.NextResponse.json({error:"User not found"},{status:404});return await (0,s.Gr)(c.id),e(t,r,c)}catch(e){return console.error("Authentication error:",e),o.NextResponse.json({error:"Authentication failed"},{status:500})}}}},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},65752:(e,t)=>{"use strict";t.A=function(e){return{id:"github",name:"GitHub",type:"oauth",authorization:{url:"https://github.com/login/oauth/authorize",params:{scope:"read:user user:email"}},token:"https://github.com/login/oauth/access_token",userinfo:{url:"https://api.github.com/user",async request({client:e,tokens:t}){let r=await e.userinfo(t.access_token);if(!r.email){let e=await fetch("https://api.github.com/user/emails",{headers:{Authorization:`token ${t.access_token}`}});if(e.ok){var s;let t=await e.json();r.email=(null!=(s=t.find(e=>e.primary))?s:t[0]).email}}return r}},profile(e){var t;return{id:e.id.toString(),name:null!=(t=e.name)?t:e.login,email:e.email,image:e.avatar_url}},style:{logo:"/github.svg",bg:"#24292f",text:"#fff"},options:e}}},74075:e=>{"use strict";e.exports=require("zlib")},76926:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"createDedupedByCallsiteServerErrorLoggerDev",{enumerable:!0,get:function(){return c}});let s=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=a(t);if(r&&r.has(e))return r.get(e);var s={__proto__:null},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var n=i?Object.getOwnPropertyDescriptor(e,o):null;n&&(n.get||n.set)?Object.defineProperty(s,o,n):s[o]=e[o]}return s.default=e,r&&r.set(e,s),s}(r(61120));function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(a=function(e){return e?r:t})(e)}let i={current:null},o="function"==typeof s.cache?s.cache:e=>e,n=console.warn;function c(e){return function(...t){n(e(...t))}}o(e=>{try{n(i.current)}finally{i.current=null}})},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},86753:(e,t,r)=>{"use strict";r.d(t,{N:()=>l});var s=r(16467),a=r(13581),i=r(36344),o=r(65752),n=r(96330),c=r(5486);r(19854);let u=new n.PrismaClient,l={adapter:(0,s.y)(u),session:{strategy:"jwt"},pages:{signIn:"/auth/login",signOut:"/auth/logout",error:"/auth/error"},providers:[(0,a.A)({name:"Credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let t=await u.user.findUnique({where:{email:e.email}});return t&&t.password&&await (0,c.compare)(e.password,t.password)?{id:t.id,email:t.email,name:t.name,image:t.image}:null}}),(0,i.A)({clientId:process.env.GOOGLE_CLIENT_ID||"",clientSecret:process.env.GOOGLE_CLIENT_SECRET||""}),(0,o.A)({clientId:process.env.GITHUB_CLIENT_ID||"",clientSecret:process.env.GITHUB_CLIENT_SECRET||""})],callbacks:{session:async({session:e,token:t})=>(t&&(e.user.id=t.id,e.user.name=t.name,e.user.email=t.email,e.user.image=t.picture),e),jwt:async({token:e,user:t})=>(t&&(e.id=t.id),e)}}},94735:e=>{"use strict";e.exports=require("events")},96330:e=>{"use strict";e.exports=require("@prisma/client")},96487:()=>{}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[4243,580,9854,8909],()=>r(33131));module.exports=s})();