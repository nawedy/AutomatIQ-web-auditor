"use strict";(()=>{var e={};e.id=481,e.ids=[481],e.modules={3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},5486:e=>{e.exports=require("bcrypt")},8086:e=>{e.exports=require("module")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11723:e=>{e.exports=require("querystring")},12412:e=>{e.exports=require("assert")},21820:e=>{e.exports=require("os")},27910:e=>{e.exports=require("stream")},28354:e=>{e.exports=require("util")},29021:e=>{e.exports=require("fs")},29272:(e,r,t)=>{t.r(r),t.d(r,{patchFetch:()=>y,routeModule:()=>m,serverHooks:()=>v,workAsyncStorage:()=>x,workUnitAsyncStorage:()=>g});var s={};t.r(s),t.d(s,{GET:()=>c,POST:()=>l});var o=t(96559),i=t(48088),a=t(37719),n=t(32190),p=t(43254),u=t(7462),d=t(78995);let c=(0,p.ru)(async(e,{params:r},t)=>{try{let e=r.id,s=await u.zR.audit.findFirst({where:{id:e,userId:t.id},include:{website:!0,auditResults:{include:{category:!0,check:!0}},pages:{include:{pageAuditResults:!0}},auditSummary:!0}});if(!s)return n.NextResponse.json({error:"Audit not found or you do not have permission to access it"},{status:404});let o={id:s.id,websiteName:s.website.name,websiteUrl:s.website.url,createdAt:s.createdAt,completedAt:s.completedAt||void 0,overallScore:s.overallScore||void 0,categories:[]},i=new Map;return s.auditResults.forEach(e=>{let r=e.category.name;i.has(r)||i.set(r,{name:r,score:0,issues:[]});let t=i.get(r);("FAILURE"===e.status||"WARNING"===e.status)&&t.issues.push({title:e.check.name,description:e.details||"No details provided",severity:"FAILURE"===e.status?"High":"Medium",impact:e.impact||"Unknown",recommendation:e.recommendations||void 0}),"SEO"===e.category.name&&s.seoScore?t.score=s.seoScore:"Performance"===e.category.name&&s.performanceScore?t.score=s.performanceScore:"Accessibility"===e.category.name&&s.accessibilityScore?t.score=s.accessibilityScore:"Security"===e.category.name&&s.securityScore?t.score=s.securityScore:"Mobile"===e.category.name&&s.mobileScore?t.score=s.mobileScore:"Content"===e.category.name&&s.contentScore&&(t.score=s.contentScore)}),o.categories=Array.from(i.values()),s.pages&&s.pages.length>0&&(o.pages=s.pages.map(e=>({url:e.url,title:e.title||void 0,score:e.score||void 0,issues:e.pageAuditResults.filter(e=>"FAILURE"===e.status||"WARNING"===e.status).map(e=>({title:e.checkName||"Unknown check",description:e.details||"No details provided",severity:"FAILURE"===e.status?"High":"Medium",impact:e.impact||"Unknown",recommendation:e.recommendations||void 0}))}))),n.NextResponse.json(o)}catch(e){return console.error("Error preparing audit data for export:",e),n.NextResponse.json({error:`Failed to prepare audit data: ${e.message}`},{status:500})}}),l=(0,p.ru)(async(e,{params:r},t)=>{try{let s=r.id;if(!await u.zR.audit.findFirst({where:{id:s,userId:t.id}}))return n.NextResponse.json({error:"Audit not found or you do not have permission to access it"},{status:404});let{format:o,options:i}=await e.json(),a=new d._(u.zR);if("pdf"===o){let e=await a.exportToPdf(s,i);return new n.NextResponse(e,{headers:{"Content-Type":"application/pdf","Content-Disposition":`attachment; filename="audit-report-${s}.pdf"`}})}if("csv"!==o)return n.NextResponse.json({error:"Invalid export format. Supported formats: pdf, csv"},{status:400});{let e=await a.exportToCsv(s);return new n.NextResponse(e,{headers:{"Content-Type":"text/csv","Content-Disposition":`attachment; filename="audit-report-${s}.csv"`}})}}catch(e){return console.error("Error exporting audit report:",e),n.NextResponse.json({error:`Failed to export audit report: ${e.message}`},{status:500})}}),m=new o.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/audits/[id]/export/route",pathname:"/api/audits/[id]/export",filename:"route",bundlePath:"app/api/audits/[id]/export/route"},resolvedPagePath:"/Users/drgn003/AutomatIQ/AI-website-auditor/app/api/audits/[id]/export/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:x,workUnitAsyncStorage:g,serverHooks:v}=m;function y(){return(0,a.patchFetch)({workAsyncStorage:x,workUnitAsyncStorage:g})}},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{e.exports=require("path")},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{e.exports=require("crypto")},55591:e=>{e.exports=require("https")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{e.exports=require("zlib")},79428:e=>{e.exports=require("buffer")},79551:e=>{e.exports=require("url")},81630:e=>{e.exports=require("http")},94735:e=>{e.exports=require("events")},96330:e=>{e.exports=require("@prisma/client")}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[4243,580,9854,8909,872,5504],()=>t(29272));module.exports=s})();