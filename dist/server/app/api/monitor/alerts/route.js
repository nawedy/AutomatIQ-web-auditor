"use strict";(()=>{var e={};e.id=7650,e.ids=[7650],e.modules={3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},5486:e=>{e.exports=require("bcrypt")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11723:e=>{e.exports=require("querystring")},12412:e=>{e.exports=require("assert")},21820:e=>{e.exports=require("os")},27910:e=>{e.exports=require("stream")},28354:e=>{e.exports=require("util")},29021:e=>{e.exports=require("fs")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},32325:e=>{e.exports=require("jsdom")},33873:e=>{e.exports=require("path")},34631:e=>{e.exports=require("tls")},37366:e=>{e.exports=require("dns")},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{e.exports=require("crypto")},55591:e=>{e.exports=require("https")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{e.exports=require("zlib")},77598:e=>{e.exports=require("node:crypto")},79428:e=>{e.exports=require("buffer")},79551:e=>{e.exports=require("url")},79646:e=>{e.exports=require("child_process")},81630:e=>{e.exports=require("http")},91645:e=>{e.exports=require("net")},94735:e=>{e.exports=require("events")},95566:(e,r,s)=>{s.r(r),s.d(r,{patchFetch:()=>N,routeModule:()=>h,serverHooks:()=>R,workAsyncStorage:()=>j,workUnitAsyncStorage:()=>v});var t={};s.r(t),s.d(t,{GET:()=>b,POST:()=>y});var o=s(96559),i=s(48088),a=s(37719),n=s(32190),u=s(43254),p=s(72820),l=s(96330),d=s(51672),c=s(68803);let x=new l.PrismaClient;async function m(e,r,s){if(!e)return{isValid:!1,error:"Website ID is required",response:n.NextResponse.json({error:"Website ID is required"},{status:400})};if(!(0,c.aJ)(e))return{isValid:!1,error:"Invalid website ID format",response:n.NextResponse.json({error:"Invalid website ID format"},{status:400})};try{let t=await x.website.findFirst({where:{id:e,OR:[{userId:r},...s?[{id:{not:""}}]:[]]}});if(!t)return{isValid:!1,error:"Website not found or you do not have permission to access it",response:n.NextResponse.json({error:"Website not found or you do not have permission to access it"},{status:404})};return{isValid:!0,website:t}}catch(e){return console.error("Error validating website access:",e),{isValid:!1,error:`Failed to validate website access: ${e.message}`,response:n.NextResponse.json({error:`Failed to validate website access: ${e.message}`},{status:500})}}}async function f(){try{await x.$disconnect()}catch(e){console.error("Error disconnecting from database:",e)}}var w=s(49481);let g=new l.PrismaClient,q=new d.GL(g),b=(0,p.Y)((0,u.ru)(async(e,r,s)=>{try{let{searchParams:r}=new URL(e.url),t=(0,w.xV)(r.get("websiteId")),o="true"===r.get("unreadOnly"),i=(0,w.xV)(r.get("limit")),a=(0,w.xV)(r.get("offset")),u=await m(t,s.id,"ADMIN"===s.role);if(!u.isValid)return u.response||n.NextResponse.json({error:"Access denied"},{status:403});let p=function(e,r){let s=10,t=0;if(e){let r=parseInt(e,10);if(isNaN(r)||r<1)return{limit:s,offset:t,isValid:!1,error:"Limit must be a positive number",response:n.NextResponse.json({error:"Limit must be a positive number"},{status:400})};s=Math.min(r,100)}if(r){let e=parseInt(r,10);if(isNaN(e)||e<0)return{limit:s,offset:t,isValid:!1,error:"Offset must be a non-negative number",response:n.NextResponse.json({error:"Offset must be a non-negative number"},{status:400})};t=e}return{limit:s,offset:t,isValid:!0}}(i,a);if(!p.isValid)return n.NextResponse.json({error:p.error},{status:400});let{limit:l,offset:d}=p,c=(0,w.xV)(t),x=Math.floor(d/l)+1,f=await q.getAlertsFromCacheOrDatabase(c,x,l,o),g=await q.getAlertsCount(c,o);return n.NextResponse.json({alerts:f,pagination:{total:g,limit:l,offset:d,hasMore:d+l<g}})}catch(e){return console.error("Error fetching monitoring alerts:",e),n.NextResponse.json({error:"Failed to fetch monitoring alerts",message:e.message},{status:500})}finally{await f()}}),{requestsPerWindow:20,window:"60 s"}),y=(0,p.Y)((0,u.ru)(async(e,r,s)=>{try{let r=await e.json(),{alertIds:t,websiteId:o}=(0,w.Zm)(r),i=Array.isArray(t)?(0,w.Z5)(t):[];if(!i||!Array.isArray(i)||0===i.length)return n.NextResponse.json({error:"Alert IDs are required"},{status:400});if(!o)return n.NextResponse.json({error:"Website ID is required"},{status:400});let a=(0,w.xV)(o),u=await m(a,s.id,"ADMIN"===s.role);if(!u.isValid)return n.NextResponse.json({error:u.error||"Access denied"},{status:403});let p=function(e){if(!e||!Array.isArray(e)||0===e.length)return{success:!1,error:"Alert IDs are required and must be a non-empty array",response:n.NextResponse.json({error:"Alert IDs are required and must be a non-empty array"},{status:400})};for(let r of e)if(!(0,c.aJ)(r))return{success:!1,error:`Invalid alert ID format: ${r}`,response:n.NextResponse.json({error:`Invalid alert ID format: ${r}`},{status:400})};return{success:!0}}(i);if(!p.success)return n.NextResponse.json({error:p.error},{status:400});if((await g.alert.findMany({where:{id:{in:i},websiteId:a},select:{id:!0}})).length!==i.length)return n.NextResponse.json({error:"Some alerts do not exist or do not belong to the specified website"},{status:400});if(!await q.markAlertsAsRead(a,i))return n.NextResponse.json({error:"Failed to mark alerts as read"},{status:500});return n.NextResponse.json({success:!0})}catch(e){return console.error("Error marking alerts as read:",e),n.NextResponse.json({error:"Failed to mark alerts as read",message:e.message},{status:500})}finally{await f()}}),{requestsPerWindow:10,window:"60 s"}),h=new o.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/monitor/alerts/route",pathname:"/api/monitor/alerts",filename:"route",bundlePath:"app/api/monitor/alerts/route"},resolvedPagePath:"/Users/drgn003/AutomatIQ/AI-website-auditor/app/api/monitor/alerts/route.ts",nextConfigOutput:"",userland:t}),{workAsyncStorage:j,workUnitAsyncStorage:v,serverHooks:R}=h;function N(){return(0,a.patchFetch)({workAsyncStorage:j,workUnitAsyncStorage:v})}},96330:e=>{e.exports=require("@prisma/client")}};var r=require("../../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[4243,580,9854,8909,9526,1426,8420,5145,1320,2729,1672,4907],()=>s(95566));module.exports=t})();