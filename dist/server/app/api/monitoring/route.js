"use strict";(()=>{var e={};e.id=8232,e.ids=[8232],e.modules={643:e=>{e.exports=require("node:perf_hooks")},2321:e=>{e.exports=require("@axe-core/puppeteer")},3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4573:e=>{e.exports=require("node:buffer")},5486:e=>{e.exports=require("bcrypt")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11723:e=>{e.exports=require("querystring")},12412:e=>{e.exports=require("assert")},13581:(e,t)=>{t.A=function(e){return{id:"credentials",name:"Credentials",type:"credentials",credentials:{},authorize:()=>null,options:e}}},16141:e=>{e.exports=require("node:zlib")},16467:(e,t,r)=>{r.d(t,{y:()=>n});var i=r(96330);function n(e){return{createUser:({id:t,...r})=>e.user.create(o(r)),getUser:t=>e.user.findUnique({where:{id:t}}),getUserByEmail:t=>e.user.findUnique({where:{email:t}}),async getUserByAccount(t){let r=await e.account.findUnique({where:{provider_providerAccountId:t},include:{user:!0}});return r?.user??null},updateUser:({id:t,...r})=>e.user.update({where:{id:t},...o(r)}),deleteUser:t=>e.user.delete({where:{id:t}}),linkAccount:t=>e.account.create({data:t}),unlinkAccount:t=>e.account.delete({where:{provider_providerAccountId:t}}),async getSessionAndUser(t){let r=await e.session.findUnique({where:{sessionToken:t},include:{user:!0}});if(!r)return null;let{user:i,...n}=r;return{user:i,session:n}},createSession:t=>e.session.create(o(t)),updateSession:t=>e.session.update({where:{sessionToken:t.sessionToken},...o(t)}),deleteSession:t=>e.session.delete({where:{sessionToken:t}}),async createVerificationToken(t){let r=await e.verificationToken.create(o(t));return"id"in r&&r.id&&delete r.id,r},async useVerificationToken(t){try{let r=await e.verificationToken.delete({where:{identifier_token:t}});return"id"in r&&r.id&&delete r.id,r}catch(e){if(e instanceof i.Prisma.PrismaClientKnownRequestError&&"P2025"===e.code)return null;throw e}},getAccount:async(t,r)=>e.account.findFirst({where:{providerAccountId:t,provider:r}}),createAuthenticator:async t=>e.authenticator.create(o(t)),getAuthenticator:async t=>e.authenticator.findUnique({where:{credentialID:t}}),listAuthenticatorsByUserId:async t=>e.authenticator.findMany({where:{userId:t}}),updateAuthenticatorCounter:async(t,r)=>e.authenticator.update({where:{credentialID:t},data:{counter:r}})}}function o(e){let t={};for(let r in e)void 0!==e[r]&&(t[r]=e[r]);return{data:t}}},16698:e=>{e.exports=require("node:async_hooks")},21820:e=>{e.exports=require("os")},22121:(e,t,r)=>{r.a(e,async(e,i)=>{try{r.d(t,{X:()=>a});var n=r(56941),o=r(36600),s=e([o]);o=(s.then?(await s)():s)[0];class a{constructor(e){this.prisma=e,this.notificationService=new n.J(e)}async processScheduledMonitoring(){try{let e=new Date,t=await this.prisma.website.findMany({where:{monitoringEnabled:!0,nextMonitoringAt:{lte:e}},include:{monitoringSchedule:!0,user:!0}});for(let e of(console.log(`Found ${t.length} websites due for monitoring`),t))await this.monitorWebsite(e)}catch(e){console.error("Error processing scheduled monitoring:",e)}}async monitorWebsite(e){try{let{id:t,url:r,userId:i,monitoringSchedule:n}=e,s=n?.type||"DAILY",a=n?.categories||["SEO","PERFORMANCE","ACCESSIBILITY","SECURITY"];console.log(`Monitoring website ${t} (${r}) with type ${s}`);let u=await this.prisma.audit.findFirst({where:{websiteId:t},orderBy:{createdAt:"desc"}}),c=await this.prisma.audit.create({data:{websiteId:t,userId:i,type:"MONITORING",status:"QUEUED",categories:a,url:r}}),d=new o.K(this.prisma),l=await d.runAudit(c.id,r,a);await this.notificationService.createAuditNotifications(c.id,t,i,u?.id||null,l),await this.updateNextMonitoringTime(e),console.log(`Completed monitoring for website ${t}`)}catch(t){console.error(`Error monitoring website ${e.id}:`,t),await this.updateNextMonitoringTime(e)}}async updateNextMonitoringTime(e){let t,r=new Date;switch(e.monitoringSchedule?.type||"DAILY"){case"HOURLY":t=new Date(r.getTime()+36e5);break;case"DAILY":default:t=new Date(r.getTime()+864e5);break;case"WEEKLY":t=new Date(r.getTime()+6048e5);break;case"MONTHLY":(t=new Date(r)).setDate(t.getDate()+30)}await this.prisma.website.update({where:{id:e.id},data:{lastMonitoredAt:r,nextMonitoringAt:t}})}async enableMonitoring(e,t="DAILY",r=["SEO","PERFORMANCE","ACCESSIBILITY","SECURITY"]){let i,n=new Date;i=new Date(n.getTime()+36e5),await this.prisma.website.update({where:{id:e},data:{monitoringEnabled:!0,nextMonitoringAt:i,monitoringSchedule:{upsert:{create:{type:t,categories:r},update:{type:t,categories:r}}}}})}async disableMonitoring(e){await this.prisma.website.update({where:{id:e},data:{monitoringEnabled:!1,nextMonitoringAt:null}})}async updateMonitoringSchedule(e,t,r){await this.prisma.website.update({where:{id:e},data:{monitoringSchedule:{upsert:{create:{type:t,categories:r},update:{type:t,categories:r}}}}})}async getMonitoringStatus(e){let t=await this.prisma.website.findUnique({where:{id:e},include:{monitoringSchedule:!0}});if(!t)throw Error(`Website with ID ${e} not found`);return{enabled:t.monitoringEnabled,schedule:t.monitoringSchedule,lastMonitoredAt:t.lastMonitoredAt,nextMonitoringAt:t.nextMonitoringAt}}async getMonitoringHistory(e,t=1,r=10){let[i,n]=await Promise.all([this.prisma.audit.findMany({where:{websiteId:e,type:"MONITORING"},orderBy:{createdAt:"desc"},skip:(t-1)*r,take:r,select:{id:!0,createdAt:!0,completedAt:!0,status:!0,overallScore:!0,seoScore:!0,performanceScore:!0,accessibilityScore:!0,securityScore:!0,mobileScore:!0,contentScore:!0}}),this.prisma.audit.count({where:{websiteId:e,type:"MONITORING"}})]);return{audits:i,total:n}}}i()}catch(e){i(e)}})},22316:e=>{e.exports=require("lighthouse")},27910:e=>{e.exports=require("stream")},28354:e=>{e.exports=require("util")},29021:e=>{e.exports=require("fs")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},32467:e=>{e.exports=require("node:http2")},33873:e=>{e.exports=require("path")},34589:e=>{e.exports=require("node:assert")},34631:e=>{e.exports=require("tls")},36344:(e,t)=>{t.A=function(e){return{id:"google",name:"Google",type:"oauth",wellKnown:"https://accounts.google.com/.well-known/openid-configuration",authorization:{params:{scope:"openid email profile"}},idToken:!0,checks:["pkce","state"],profile:e=>({id:e.sub,name:e.name,email:e.email,image:e.picture}),style:{logo:"/google.svg",bg:"#fff",text:"#000"},options:e}}},37067:e=>{e.exports=require("node:http")},37366:e=>{e.exports=require("dns")},37540:e=>{e.exports=require("node:console")},40610:e=>{e.exports=require("node:dns")},41204:e=>{e.exports=require("string_decoder")},41692:e=>{e.exports=require("node:tls")},41792:e=>{e.exports=require("node:querystring")},43254:(e,t,r)=>{r.d(t,{ru:()=>a});var i=r(7462),n=r(19854),o=r(86753),s=r(32190);function a(e){return async(t,r)=>{try{let a=await (0,n.getServerSession)(o.N);if(!a?.user?.email)return s.NextResponse.json({error:"Unauthorized"},{status:401});let u=await i.zR.user.findUnique({where:{email:a.user.email},select:{id:!0,email:!0}});if(!u)return s.NextResponse.json({error:"User not found"},{status:404});return await (0,i.Gr)(u.id),e(t,r,u)}catch(e){return console.error("Authentication error:",e),s.NextResponse.json({error:"Authentication failed"},{status:500})}}}},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},46906:e=>{e.exports=require("resemblejs")},53053:e=>{e.exports=require("node:diagnostics_channel")},55511:e=>{e.exports=require("crypto")},55591:e=>{e.exports=require("https")},57075:e=>{e.exports=require("node:stream")},57975:e=>{e.exports=require("node:util")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},65752:(e,t)=>{t.A=function(e){return{id:"github",name:"GitHub",type:"oauth",authorization:{url:"https://github.com/login/oauth/authorize",params:{scope:"read:user user:email"}},token:"https://github.com/login/oauth/access_token",userinfo:{url:"https://api.github.com/user",async request({client:e,tokens:t}){let r=await e.userinfo(t.access_token);if(!r.email){let e=await fetch("https://api.github.com/user/emails",{headers:{Authorization:`token ${t.access_token}`}});if(e.ok){var i;let t=await e.json();r.email=(null!=(i=t.find(e=>e.primary))?i:t[0]).email}}return r}},profile(e){var t;return{id:e.id.toString(),name:null!=(t=e.name)?t:e.login,email:e.email,image:e.avatar_url}},style:{logo:"/github.svg",bg:"#24292f",text:"#fff"},options:e}}},73136:e=>{e.exports=require("node:url")},73429:e=>{e.exports=require("node:util/types")},73948:(e,t,r)=>{r.a(e,async(e,i)=>{try{r.r(t),r.d(t,{patchFetch:()=>c,routeModule:()=>d,serverHooks:()=>h,workAsyncStorage:()=>l,workUnitAsyncStorage:()=>p});var n=r(96559),o=r(48088),s=r(37719),a=r(79405),u=e([a]);a=(u.then?(await u)():u)[0];let d=new n.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/monitoring/route",pathname:"/api/monitoring",filename:"route",bundlePath:"app/api/monitoring/route"},resolvedPagePath:"/Users/drgn003/AutomatIQ/AI-website-auditor/app/api/monitoring/route.ts",nextConfigOutput:"",userland:a}),{workAsyncStorage:l,workUnitAsyncStorage:p,serverHooks:h}=d;function c(){return(0,s.patchFetch)({workAsyncStorage:l,workUnitAsyncStorage:p})}i()}catch(e){i(e)}})},74075:e=>{e.exports=require("zlib")},75919:e=>{e.exports=require("node:worker_threads")},76926:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"createDedupedByCallsiteServerErrorLoggerDev",{enumerable:!0,get:function(){return u}});let i=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=n(t);if(r&&r.has(e))return r.get(e);var i={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var a=o?Object.getOwnPropertyDescriptor(e,s):null;a&&(a.get||a.set)?Object.defineProperty(i,s,a):i[s]=e[s]}return i.default=e,r&&r.set(e,i),i}(r(61120));function n(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(n=function(e){return e?r:t})(e)}let o={current:null},s="function"==typeof i.cache?i.cache:e=>e,a=console.warn;function u(e){return function(...t){a(e(...t))}}s(e=>{try{a(o.current)}finally{o.current=null}})},77030:e=>{e.exports=require("node:net")},77598:e=>{e.exports=require("node:crypto")},78474:e=>{e.exports=require("node:events")},79405:(e,t,r)=>{r.a(e,async(e,i)=>{try{r.r(t),r.d(t,{GET:()=>p,POST:()=>l,POST_CRON:()=>d});var n=r(32190),o=r(43254),s=r(79464),a=r(22121),u=r(56941),c=e([a]);a=(c.then?(await c)():c)[0];let l=(0,o.ru)(async(e,t,r)=>{try{let{websiteId:t,scheduleType:i,categories:o,alertThreshold:a}=await e.json();if(!t||!i)return n.NextResponse.json({error:"Website ID and schedule type are required"},{status:400});if(!await s.zR.website.findUnique({where:{id:t,userId:r.id}}))return n.NextResponse.json({error:"Website not found or access denied"},{status:404});let u=await s.zR.monitoringConfiguration.create({data:{websiteId:t,userId:r.id,scheduleType:i,categories:o||[],alertThreshold:a||0}});return n.NextResponse.json({success:!0,monitoring:u,message:"Continuous monitoring enabled successfully"})}catch(e){return console.error("Error setting up monitoring:",e),n.NextResponse.json({error:"Failed to set up monitoring"},{status:500})}}),p=(0,o.ru)(async(e,t,r)=>{try{let{searchParams:t}=new URL(e.url),i=t.get("websiteId"),o={website:{userId:r.id}};i&&(o.websiteId=i),await s.zR.websiteMonitoring.findMany({where:o,include:{website:{select:{name:!0,url:!0}}}});let a=await s.zR.audit.findMany({where:{websiteId:i,userId:r.id,type:"MONITORING"},orderBy:{createdAt:"desc"},take:10});return n.NextResponse.json({audits:a,total:a.length})}catch(e){return console.error("Error fetching monitoring configurations:",e),n.NextResponse.json({error:"Failed to fetch monitoring configurations"},{status:500})}});async function d(e){try{if(e.headers.get("x-api-key")!==process.env.MONITORING_CRON_API_KEY)return n.NextResponse.json({error:"Unauthorized"},{status:401});let t=new a.X(s.zR);new u.J(s.zR);let r=await t.processScheduledMonitoring(),i=0;if(Array.isArray(r)&&r.length>0)for(let e of(i=r.length,r))e.auditId&&e.websiteId&&e.userId&&await s.zR.notification.create({data:{userId:e.userId,websiteId:e.websiteId,auditId:e.auditId,title:"Monitoring Alert",message:"New issues detected in your website monitoring",type:"MONITORING_ALERT",priority:"HIGH",channel:"IN_APP",read:!1,data:JSON.stringify(e.results||{})}});return n.NextResponse.json({success:!0,processed:i,message:"Monitoring tasks processed successfully"})}catch(e){return console.error("Error processing scheduled monitoring:",e),n.NextResponse.json({error:"Failed to process scheduled monitoring"},{status:500})}}i()}catch(e){i(e)}})},79428:e=>{e.exports=require("buffer")},79464:(e,t,r)=>{r.d(t,{Ay:()=>o,zR:()=>n});var i=r(96330);let n=global.prisma||new i.PrismaClient({log:["error"]}),o=n},79551:e=>{e.exports=require("url")},79646:e=>{e.exports=require("child_process")},81630:e=>{e.exports=require("http")},83636:e=>{e.exports=import("puppeteer")},83997:e=>{e.exports=require("tty")},86753:(e,t,r)=>{r.d(t,{N:()=>d});var i=r(16467),n=r(13581),o=r(36344),s=r(65752),a=r(96330),u=r(5486);r(19854);let c=new a.PrismaClient,d={adapter:(0,i.y)(c),session:{strategy:"jwt"},pages:{signIn:"/auth/login",signOut:"/auth/logout",error:"/auth/error"},providers:[(0,n.A)({name:"Credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let t=await c.user.findUnique({where:{email:e.email}});return t&&t.password&&await (0,u.compare)(e.password,t.password)?{id:t.id,email:t.email,name:t.name,image:t.image}:null}}),(0,o.A)({clientId:process.env.GOOGLE_CLIENT_ID||"",clientSecret:process.env.GOOGLE_CLIENT_SECRET||""}),(0,s.A)({clientId:process.env.GITHUB_CLIENT_ID||"",clientSecret:process.env.GITHUB_CLIENT_SECRET||""})],callbacks:{session:async({session:e,token:t})=>(t&&(e.user.id=t.id,e.user.name=t.name,e.user.email=t.email,e.user.image=t.picture),e),jwt:async({token:e,user:t})=>(t&&(e.id=t.id),e)}}},91645:e=>{e.exports=require("net")},94735:e=>{e.exports=require("events")},96330:e=>{e.exports=require("@prisma/client")}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[4243,580,9854,8909,9526,3810,2729,9061],()=>r(73948));module.exports=i})();