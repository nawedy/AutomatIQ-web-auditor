(()=>{var e={};e.id=963,e.ids=[963],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},22882:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>m,routeModule:()=>h,serverHooks:()=>y,workAsyncStorage:()=>f,workUnitAsyncStorage:()=>g});var a={};r.r(a),r.d(a,{GET:()=>u,POST:()=>d});var s=r(96559),o=r(48088),n=r(37719),i=r(32190);class p{constructor(e){this.config=e,this.baseUrl=`${e.url}/api`,this.headers={"Content-Type":"application/json"},e.token&&(this.headers.Authorization=`Bearer ${e.token}`)}async fetch(e,t={}){let r=`${this.baseUrl}${e}`;try{let e=await fetch(r,{headers:{...this.headers,...t.headers},timeout:this.config.timeout||1e4,...t}),a=await e.json();if(!e.ok)return{data:null,error:{status:e.status,name:a.error?.name||"StrapiError",message:a.error?.message||"An error occurred",details:a.error?.details}};return a}catch(e){return{data:null,error:{status:500,name:"NetworkError",message:e instanceof Error?e.message:"Network error occurred"}}}}async find(e,t={}){let r=new URLSearchParams;t.filters&&Object.entries(t.filters).forEach(([e,t])=>{"object"==typeof t?Object.entries(t).forEach(([t,a])=>{r.append(`filters[${e}][$${t}]`,String(a))}):r.append(`filters[${e}]`,String(t))}),t.sort&&(Array.isArray(t.sort)?t.sort:[t.sort]).forEach(e=>{r.append("sort",e)}),t.populate&&("string"==typeof t.populate?r.append("populate",t.populate):Array.isArray(t.populate)?t.populate.forEach(e=>{r.append("populate",e)}):Object.entries(t.populate).forEach(([e,t])=>{r.append(`populate[${e}]`,JSON.stringify(t))})),t.pagination&&Object.entries(t.pagination).forEach(([e,t])=>{void 0!==t&&r.append(`pagination[${e}]`,String(t))}),t.fields&&t.fields.forEach(e=>{r.append("fields",e)}),t.locale&&r.append("locale",t.locale),t.publicationState&&r.append("publicationState",t.publicationState);let a=r.toString(),s=`/${e}${a?`?${a}`:""}`;return this.fetch(s)}async findOne(e,t,r={}){let a=new URLSearchParams;r.populate&&("string"==typeof r.populate?a.append("populate",r.populate):Array.isArray(r.populate)&&r.populate.forEach(e=>{a.append("populate",e)})),r.fields&&r.fields.forEach(e=>{a.append("fields",e)}),r.locale&&a.append("locale",r.locale);let s=a.toString(),o=`/${e}/${t}${s?`?${s}`:""}`;return this.fetch(o)}async create(e,t){return this.fetch(`/${e}`,{method:"POST",body:JSON.stringify({data:t})})}async update(e,t,r){return this.fetch(`/${e}/${t}`,{method:"PUT",body:JSON.stringify({data:r})})}async delete(e,t){return this.fetch(`/${e}/${t}`,{method:"DELETE"})}async upload(e,t={}){let r=new FormData;Array.isArray(e)?e.forEach(e=>{r.append("files",e)}):r.append("files",e),t.ref&&r.append("ref",t.ref),t.refId&&r.append("refId",String(t.refId)),t.field&&r.append("field",t.field);let a={...this.headers};return delete a["Content-Type"],this.fetch("/upload",{method:"POST",headers:a,body:r})}}new p({url:process.env.STRAPI_URL||"http://localhost:1337",token:process.env.STRAPI_API_TOKEN,timeout:1e4});let c={cache:new Map,async getCached(e,t,r=15){let a=this.cache.get(e),s=Date.now();if(a&&a.expiry>s)return a.data;let o=await t();return this.cache.set(e,{data:o,expiry:s+60*r*1e3}),o},clearCache(e){e?this.cache.delete(e):this.cache.clear()}},l={handleWebhook(e){let{event:t,model:r}=e;switch(r){case"blog-post":c.clearCache("blog-posts"),c.clearCache("featured-posts");break;case"case-study":c.clearCache("case-studies"),c.clearCache("featured-case-studies");break;case"global-setting":c.clearCache("global-settings");break;default:c.clearCache()}console.log(`Cache cleared for ${r} due to ${t} event`)}};async function d(e){try{let t=process.env.STRAPI_WEBHOOK_SECRET;if(t){let r=e.headers.get("x-strapi-signature");if(!r||r!==t)return console.warn("Invalid webhook signature"),i.NextResponse.json({error:"Invalid webhook signature"},{status:401})}let r=await e.json();return console.log("Received Strapi webhook:",{event:r.event,model:r.model,entryId:r.entry?.id,timestamp:r.createdAt}),l.handleWebhook(r),console.log(`Processed ${r.event} event for ${r.model}`),i.NextResponse.json({success:!0,message:"Webhook processed successfully",event:r.event,model:r.model},{status:200})}catch(e){return console.error("Error processing Strapi webhook:",e),i.NextResponse.json({error:"Internal server error",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function u(e){let{searchParams:t}=new URL(e.url),r=t.get("challenge");return r?i.NextResponse.json({challenge:r}):i.NextResponse.json({message:"Strapi webhook endpoint is active",timestamp:new Date().toISOString()},{status:200})}let h=new s.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/strapi/webhook/route",pathname:"/api/strapi/webhook",filename:"route",bundlePath:"app/api/strapi/webhook/route"},resolvedPagePath:"/Users/drgn003/AutomatIQ/AI-website-auditor/app/api/strapi/webhook/route.ts",nextConfigOutput:"",userland:a}),{workAsyncStorage:f,workUnitAsyncStorage:g,serverHooks:y}=h;function m(){return(0,n.patchFetch)({workAsyncStorage:f,workUnitAsyncStorage:g})}},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[4243,580],()=>r(22882));module.exports=a})();