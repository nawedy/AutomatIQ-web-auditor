"use strict";exports.id=3612,exports.ids=[3612],exports.modules={7462:(e,t,a)=>{a.d(t,{Gr:()=>n,zR:()=>i});var r=a(96330),s=a(88909);let i=globalThis.prisma??new r.PrismaClient({log:["error"],datasources:{db:{url:process.env.DATABASE_URL}}});async function n(e){try{await i.$executeRaw`SELECT set_config('app.current_user_id', ${e}, false)`}catch(e){throw console.error("Failed to set current user ID:",e),e}}process.env.DATABASE_URL&&new s.bC({connectionString:process.env.DATABASE_URL})},43254:(e,t,a)=>{a.d(t,{ru:()=>l});var r=a(7462),s=a(19854),i=a(86753),n=a(32190);function l(e){return async(t,a)=>{try{let l=await (0,s.getServerSession)(i.N);if(!l?.user?.email)return n.NextResponse.json({error:"Unauthorized"},{status:401});let o=await r.zR.user.findUnique({where:{email:l.user.email},select:{id:!0,email:!0}});if(!o)return n.NextResponse.json({error:"User not found"},{status:404});return await (0,r.Gr)(o.id),e(t,a,o)}catch(e){return console.error("Authentication error:",e),n.NextResponse.json({error:"Authentication failed"},{status:500})}}}},81111:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.d(t,{v:()=>c});var s=a(23870),i=a(7462),n=a(24263),l=a(59841),o=a(64272),d=a(86370),u=e([n]);n=(u.then?(await u)():u)[0];class c{constructor(){this.crawler=new n.J,this.seoAnalyzer=new l.G,this.performanceAnalyzer=new o.F,this.accessibilityAnalyzer=new d.n}async startAudit(e,t){let a=(0,s.A)();try{let r=await i.zR.website.findUnique({where:{id:e}});if(!r)throw Error("Website not found");let s=n.J.normalizeUrl(r.url);if(!n.J.isValidUrl(s))throw Error("Invalid URL provided");return await i.zR.audit.create({data:{id:a,websiteId:e,status:"pending",startedAt:new Date}}),this.processAudit(a,s,t).catch(e=>{console.error(`Audit ${a} failed:`,e),this.updateAuditStatus(a,"failed")}),a}catch(e){throw console.error("Failed to start audit:",e),Error("Failed to start audit: "+(e instanceof Error?e.message:"Unknown error"))}}async processAudit(e,t,a){let r=Date.now();try{await this.updateAuditStatus(e,"running"),await this.crawler.init(),console.log(`üï∑Ô∏è Crawling website: ${t}`);let s=Date.now(),n=await this.crawler.crawl(t),l=Date.now()-s;n.errors.length>0&&console.warn(`Crawl completed with ${n.errors.length} errors for ${t}`),console.log("\uD83D\uDD0D Analyzing website...");let o=Date.now(),d=await this.getAuditCategories(),u=[],c=0,h=0,w=0,g=0,m=0;for(let r of d){let s=await this.getAuditChecks(r.id);if(0!==s.length&&a[r.key])for(let a of s)try{let r=await this.runCheck(a,n,t),s=await i.zR.auditResult.create({data:{auditId:e,checkId:a.id,status:r.status,score:r.score,data:r.data,message:r.message,severity:r.severity}});u.push(s),h++,"passed"===s.status?w++:"failed"===s.status?g++:"warning"===s.status&&m++,c+=s.score}catch(r){console.error(`Check ${a.id} failed:`,r);let t=await i.zR.auditResult.create({data:{auditId:e,checkId:a.id,status:"error",score:0,data:{},message:`Error: ${r instanceof Error?r.message:"Unknown error"}`,severity:"high"}});u.push(t),h++,g++}}let p=h>0?Math.round(c/h):0;await i.zR.auditSummary.create({data:{auditId:e,score:p,passedChecks:w,failedChecks:g,warningChecks:m,screenshotUrl:n.screenshots.desktop||""}});let y=Date.now()-o,f=Date.now()-r;await i.zR.audit.update({where:{id:e},data:{status:"completed",completedAt:new Date,crawlDuration:l,analysisDuration:y,totalDuration:f}}),console.log(`‚úÖ Audit ${e} completed in ${f}ms`)}catch(t){throw console.error(`‚ùå Audit ${e} failed:`,t),await this.updateAuditStatus(e,"failed"),t}finally{await this.crawler.close()}}async getAuditProgress(e){try{let t=await i.zR.audit.findUnique({where:{id:e},include:{summary:!0}});if(!t)return null;let a=0;return"pending"===t.status?a=0:"running"===t.status?a=50:"completed"===t.status&&(a=100),{id:t.id,status:t.status,progress:a,startedAt:t.startedAt,completedAt:t.completedAt,summary:t.summary}}catch(e){return console.error("Failed to get audit progress:",e),null}}async getAuditResults(e){try{return await i.zR.audit.findUnique({where:{id:e},include:{website:!0,summary:!0,auditResults:{include:{check:{include:{category:!0}}}}}})}catch(e){return console.error("Failed to get audit results:",e),null}}async updateAuditStatus(e,t){try{await i.zR.audit.update({where:{id:e},data:{status:t}})}catch(e){console.error("Failed to update audit status:",e)}}async getAuditCategories(){return await i.zR.auditCategory.findMany()}async getAuditChecks(e){return await i.zR.auditCheck.findMany({where:{categoryId:e}})}async runCheck(e,t,a){e.id;let r=e.key;if(r.includes("meta")){let e=t.html.includes("<title>");return{status:e?"passed":"failed",score:100*!!e,data:{hasTitle:e},message:e?"Page has a title tag":"Page is missing a title tag",severity:e?"low":"high"}}if(r.includes("image")){let e=t.html.match(/<img[^>]+>/g)||[],a=e.filter(e=>!e.includes("alt=")),r=0===a.length;return{status:r?"passed":a.length<e.length/2?"warning":"failed",score:r?100:Math.max(0,100-a.length/e.length*100),data:{total:e.length,missing:a.length},message:r?"All images have alt text":`${a.length} of ${e.length} images are missing alt text`,severity:r?"low":a.length<e.length/2?"medium":"high"}}let s=Math.random();return{status:s>.7?"passed":s>.4?"warning":"failed",score:Math.round(100*s),data:{},message:`Check ${r} completed`,severity:s>.7?"low":s>.4?"medium":"high"}}}r()}catch(e){r(e)}})},86753:(e,t,a)=>{a.d(t,{N:()=>u});var r=a(16467),s=a(13581),i=a(36344),n=a(65752),l=a(96330),o=a(5486);a(19854);let d=new l.PrismaClient,u={adapter:(0,r.y)(d),session:{strategy:"jwt"},pages:{signIn:"/auth/login",signOut:"/auth/logout",error:"/auth/error"},providers:[(0,s.A)({name:"Credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let t=await d.user.findUnique({where:{email:e.email}});return t&&t.password&&await (0,o.compare)(e.password,t.password)?{id:t.id,email:t.email,name:t.name,image:t.image}:null}}),(0,i.A)({clientId:process.env.GOOGLE_CLIENT_ID||"",clientSecret:process.env.GOOGLE_CLIENT_SECRET||""}),(0,n.A)({clientId:process.env.GITHUB_CLIENT_ID||"",clientSecret:process.env.GITHUB_CLIENT_SECRET||""})],callbacks:{session:async({session:e,token:t})=>(t&&(e.user.id=t.id,e.user.name=t.name,e.user.email=t.email,e.user.image=t.picture),e),jwt:async({token:e,user:t})=>(t&&(e.id=t.id),e)}}}};