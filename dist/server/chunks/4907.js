"use strict";exports.id=4907,exports.ids=[4907],exports.modules={7462:(e,t,r)=>{r.d(t,{Gr:()=>s,zR:()=>a});var i=r(96330),n=r(88909);let a=globalThis.prisma??new i.PrismaClient({log:["error"],datasources:{db:{url:process.env.DATABASE_URL}}});async function s(e){try{await a.$executeRaw`SELECT set_config('app.current_user_id', ${e}, false)`}catch(e){throw console.error("Failed to set current user ID:",e),e}}process.env.DATABASE_URL&&new n.bC({connectionString:process.env.DATABASE_URL})},43254:(e,t,r)=>{r.d(t,{ru:()=>o});var i=r(7462),n=r(19854),a=r(86753),s=r(32190);function o(e){return async(t,r)=>{try{let o=await (0,n.getServerSession)(a.N);if(!o?.user?.email)return s.NextResponse.json({error:"Unauthorized"},{status:401});let l=await i.zR.user.findUnique({where:{email:o.user.email},select:{id:!0,email:!0}});if(!l)return s.NextResponse.json({error:"User not found"},{status:404});return await (0,i.Gr)(l.id),e(t,r,l)}catch(e){return console.error("Authentication error:",e),s.NextResponse.json({error:"Authentication failed"},{status:500})}}}},49481:(e,t,r)=>{r.d(t,{Jf:()=>l,Z5:()=>o,Zm:()=>s,xV:()=>a});var i=r(44415),n=r.n(i);let a=e=>e?n().sanitize(e.trim()):"",s=e=>{if(!e||"object"!=typeof e)return e;let t={...e};return Object.keys(t).forEach(e=>{let r=t[e];"string"==typeof r?t[e]=a(r):r&&"object"==typeof r&&!Array.isArray(r)&&(t[e]=s(r))}),t},o=e=>e&&Array.isArray(e)?e.map(e=>"string"==typeof e?a(e):e&&"object"==typeof e?s(e):e):e,l=e=>{if(!e)return"";try{let t=a(e),r=new URL(t);if(!["http:","https:"].includes(r.protocol))return"";return t}catch(e){return""}}},68803:(e,t,r)=>{r.d(t,{aJ:()=>n,r8:()=>a});var i=r(45697);let n=e=>/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e),a=e=>{if(!e)return!0;try{let t=new URL(e);return"https:"===t.protocol}catch(e){return!1}};i.z.object({websiteId:i.z.string().uuid({message:"Invalid website ID format"}),enabled:i.z.boolean(),frequency:i.z.enum(["DAILY","WEEKLY","BIWEEKLY","MONTHLY","QUARTERLY"]),alertThreshold:i.z.number().int().min(1).max(100),metrics:i.z.array(i.z.string()).min(1).max(10),emailNotifications:i.z.boolean(),slackWebhook:i.z.string().url().nullable().optional()}),i.z.object({alertIds:i.z.array(i.z.string().uuid({message:"Invalid alert ID format"})).min(1),websiteId:i.z.string().uuid({message:"Invalid website ID format"})}),i.z.object({limit:i.z.number().int().min(1).max(100).default(10),offset:i.z.number().int().min(0).default(0)})},72820:(e,t,r)=>{let i,n;r.d(t,{Y:()=>l});var a=r(32190),s=r(35943),o=r(5145);function l(e,t){return async function(r,...s){if(!i||!n)return console.warn("Rate limiting is not configured. Set UPSTASH_REDIS_REST_URL and UPSTASH_REDIS_REST_TOKEN env variables."),e(r,...s);let l=n;t?.requestsPerWindow&&t?.window&&(l=new o.Ratelimit({redis:i,limiter:o.Ratelimit.slidingWindow(t.requestsPerWindow,t.window),analytics:!0}));let u=t?.identifierFn?t.identifierFn(r):r.ip||"anonymous",{success:c,limit:d,reset:m,remaining:p}=await l.limit(u),f=new Headers({"X-RateLimit-Limit":d.toString(),"X-RateLimit-Remaining":p.toString(),"X-RateLimit-Reset":m.toString()});if(!c)return new a.NextResponse(JSON.stringify({error:"Too many requests",message:"Please try again later"}),{status:429,headers:f});let w=await e(r,...s);return Object.entries(f).forEach(([e,t])=>{w.headers.set(e,t)}),w}}process.env.UPSTASH_REDIS_REST_URL&&process.env.UPSTASH_REDIS_REST_TOKEN&&(i=new s.Q({url:process.env.UPSTASH_REDIS_REST_URL,token:process.env.UPSTASH_REDIS_REST_TOKEN}),n=new o.Ratelimit({redis:i,limiter:o.Ratelimit.slidingWindow(10,"10 s"),analytics:!0}))},86753:(e,t,r)=>{r.d(t,{N:()=>c});var i=r(16467),n=r(13581),a=r(36344),s=r(65752),o=r(96330),l=r(5486);r(19854);let u=new o.PrismaClient,c={adapter:(0,i.y)(u),session:{strategy:"jwt"},pages:{signIn:"/auth/login",signOut:"/auth/logout",error:"/auth/error"},providers:[(0,n.A)({name:"Credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let t=await u.user.findUnique({where:{email:e.email}});return t&&t.password&&await (0,l.compare)(e.password,t.password)?{id:t.id,email:t.email,name:t.name,image:t.image}:null}}),(0,a.A)({clientId:process.env.GOOGLE_CLIENT_ID||"",clientSecret:process.env.GOOGLE_CLIENT_SECRET||""}),(0,s.A)({clientId:process.env.GITHUB_CLIENT_ID||"",clientSecret:process.env.GITHUB_CLIENT_SECRET||""})],callbacks:{session:async({session:e,token:t})=>(t&&(e.user.id=t.id,e.user.name=t.name,e.user.email=t.email,e.user.image=t.picture),e),jwt:async({token:e,user:t})=>(t&&(e.id=t.id),e)}}}};