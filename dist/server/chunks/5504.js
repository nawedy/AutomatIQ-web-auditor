exports.id=5504,exports.ids=[5504],exports.modules={7462:(e,t,r)=>{"use strict";r.d(t,{Gr:()=>o,zR:()=>s});var a=r(96330),i=r(88909);let s=globalThis.prisma??new a.PrismaClient({log:["error"],datasources:{db:{url:process.env.DATABASE_URL}}});async function o(e){try{await s.$executeRaw`SELECT set_config('app.current_user_id', ${e}, false)`}catch(e){throw console.error("Failed to set current user ID:",e),e}}process.env.DATABASE_URL&&new i.bC({connectionString:process.env.DATABASE_URL})},43254:(e,t,r)=>{"use strict";r.d(t,{ru:()=>n});var a=r(7462),i=r(19854),s=r(86753),o=r(32190);function n(e){return async(t,r)=>{try{let n=await (0,i.getServerSession)(s.N);if(!n?.user?.email)return o.NextResponse.json({error:"Unauthorized"},{status:401});let l=await a.zR.user.findUnique({where:{email:n.user.email},select:{id:!0,email:!0}});if(!l)return o.NextResponse.json({error:"User not found"},{status:404});return await (0,a.Gr)(l.id),e(t,r,l)}catch(e){return console.error("Authentication error:",e),o.NextResponse.json({error:"Authentication failed"},{status:500})}}}},78335:()=>{},78995:(e,t,r)=>{"use strict";r.d(t,{_:()=>d});var a=r(80137);r(78374);var i=r(59770),s=r(29021),o=r.n(s),n=r(33873),l=r.n(n),c=r(21820),u=r.n(c);class d{constructor(e){this.prisma=e}async exportToPdf(e,t={includeDetails:!0,includeSummary:!0,includeRecommendations:!0,includeBranding:!0}){try{let r=await this.prisma.audit.findUnique({where:{id:e},include:{website:!0,user:{select:{name:!0,email:!0}}}});if(!r)throw Error(`Audit with ID ${e} not found`);let i=await this.prisma.auditResult.findMany({where:{auditId:e},include:{category:!0,check:!0}}),s=new a.uE,n=s.internal.pageSize.getWidth(),c=20;if(t.includeBranding){let e=t.customLogo||l().join(process.cwd(),"public","logo.png");o().existsSync(e)&&s.addImage(e,"PNG",10,10,40,15);let r=t.customColor||"#4F46E5";s.setTextColor(r),s.setFontSize(22),s.text("AutomatIQ Website Audit Report",n/2,c,{align:"center"}),c+=15}else s.setFontSize(22),s.text("Website Audit Report",n/2,c,{align:"center"}),c+=15;if(s.setTextColor(0,0,0),s.setFontSize(12),s.text(`Website: ${r.website.name} (${r.website.url})`,10,c),c+=8,s.text(`Audit Date: ${r.completedAt?new Date(r.completedAt).toLocaleDateString():"In progress"}`,10,c),c+=8,s.text(`Audit Type: ${r.type}`,10,c),c+=15,t.includeSummary&&(s.setFontSize(16),s.text("Audit Summary",10,c),c+=10,s.autoTable({startY:c,head:[["Category","Score"]],body:[["Overall",`${r.overallScore||0}/100`],["SEO",`${r.seoScore||0}/100`],["Performance",`${r.performanceScore||0}/100`],["Accessibility",`${r.accessibilityScore||0}/100`],["Security",`${r.securityScore||0}/100`],["Mobile",`${r.mobileScore||0}/100`],["Content",`${r.contentScore||0}/100`]],theme:"striped",headStyles:{fillColor:t.customColor||[79,70,229]},margin:{top:10}}),c=s.lastAutoTable.finalY+15),t.includeDetails){s.setFontSize(16),s.text("Detailed Results",10,c),c+=10;let e={};for(let[r,a]of(i.forEach(t=>{let r=t.category.name;e[r]||(e[r]=[]),e[r].push({check:t.check.name,status:t.status,score:t.score,details:t.details})}),Object.entries(e))){c>s.internal.pageSize.getHeight()-40&&(s.addPage(),c=20),s.setFontSize(14),s.text(r,10,c),c+=8;let e=a.map(e=>[e.check,e.status,`${e.score}/100`,e.details?.substring(0,50)||""]);s.autoTable({startY:c,head:[["Check","Status","Score","Details"]],body:e,theme:"striped",headStyles:{fillColor:t.customColor||[79,70,229]},margin:{top:10}}),c=s.lastAutoTable.finalY+15}}if(t.includeRecommendations){c>s.internal.pageSize.getHeight()-60&&(s.addPage(),c=20),s.setFontSize(16),s.text("Recommendations",10,c),c+=10;let e=[];i.forEach(t=>{t.recommendations&&(Array.isArray(t.recommendations)?t.recommendations:[t.recommendations]).forEach(t=>{t&&!e.includes(t)&&e.push(t)})}),s.setFontSize(12),e.forEach(e=>{c>s.internal.pageSize.getHeight()-20&&(s.addPage(),c=20);let t=s.splitTextToSize(e,n-20);s.text(t,10,c),c+=7*t.length+5})}let u=s.internal.getNumberOfPages();for(let e=1;e<=u;e++)s.setPage(e),s.setFontSize(10),s.text(`Generated on ${new Date().toLocaleDateString()} | Page ${e} of ${u}`,n/2,s.internal.pageSize.getHeight()-10,{align:"center"});return Buffer.from(s.output("arraybuffer"))}catch(e){throw console.error("Error generating PDF export:",e),Error(`Failed to export audit to PDF: ${e.message}`)}}async exportToCsv(e){try{let t=await this.prisma.audit.findUnique({where:{id:e},include:{website:!0}});if(!t)throw Error(`Audit with ID ${e} not found`);let r=(await this.prisma.auditResult.findMany({where:{auditId:e},include:{category:!0,check:!0}})).map(e=>({website:t.website.name,url:t.website.url,auditDate:t.completedAt?new Date(t.completedAt).toISOString():"In progress",category:e.category.name,check:e.check.name,status:e.status,score:e.score,details:e.details?.replace(/\n/g," ")||"",recommendations:Array.isArray(e.recommendations)?e.recommendations.join("; "):e.recommendations||""}));return new i.iX({fields:["website","url","auditDate","category","check","status","score","details","recommendations"]}).parse(r)}catch(e){throw console.error("Error generating CSV export:",e),Error(`Failed to export audit to CSV: ${e.message}`)}}async saveExportToFile(e,t){let r=u().tmpdir(),a=`audit-export-${Date.now()}.${t}`,i=l().join(r,a);return"pdf"===t?o().writeFileSync(i,e):o().writeFileSync(i,e,"utf8"),i}}},86753:(e,t,r)=>{"use strict";r.d(t,{N:()=>u});var a=r(16467),i=r(13581),s=r(36344),o=r(65752),n=r(96330),l=r(5486);r(19854);let c=new n.PrismaClient,u={adapter:(0,a.y)(c),session:{strategy:"jwt"},pages:{signIn:"/auth/login",signOut:"/auth/logout",error:"/auth/error"},providers:[(0,i.A)({name:"Credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let t=await c.user.findUnique({where:{email:e.email}});return t&&t.password&&await (0,l.compare)(e.password,t.password)?{id:t.id,email:t.email,name:t.name,image:t.image}:null}}),(0,s.A)({clientId:process.env.GOOGLE_CLIENT_ID||"",clientSecret:process.env.GOOGLE_CLIENT_SECRET||""}),(0,o.A)({clientId:process.env.GITHUB_CLIENT_ID||"",clientSecret:process.env.GITHUB_CLIENT_SECRET||""})],callbacks:{session:async({session:e,token:t})=>(t&&(e.user.id=t.id,e.user.name=t.name,e.user.email=t.email,e.user.image=t.picture),e),jwt:async({token:e,user:t})=>(t&&(e.id=t.id),e)}}},96487:()=>{}};